<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ìŠ¤ë¶€í€´ - Spring Boot AI Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import {
        getAuth,
        signInAnonymously,
        onAuthStateChanged,
        signInWithCustomToken,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import {
        getFirestore,
        collection,
        addDoc,
        query,
        getDocs,
        doc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      // Firebase Configuration
      const firebaseConfig = JSON.parse(__firebase_config);
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      const appId =
        typeof __app_id !== "undefined" ? __app_id : "spring-boot-quiz-app";

      let currentUser = null;

      const initAuth = async () => {
        if (
          typeof __initial_auth_token !== "undefined" &&
          __initial_auth_token
        ) {
          await signInWithCustomToken(auth, __initial_auth_token);
        } else {
          await signInAnonymously(auth);
        }
      };

      onAuthStateChanged(auth, (u) => {
        currentUser = u;
      });

      initAuth();

      // Global State
      const apiKey = "";
      let quizData = [];
      let currentQuestionIndex = 0;
      let userAnswers = [];
      let selectedDifficulty = "";
      let selectedQuestionCount = 5;

      // UI Helpers
      window.showScreen = (screenId) => {
        const screens = [
          "start-screen",
          "difficulty-screen",
          "loading-screen",
          "quiz-screen",
          "result-screen",
          "history-screen",
          "history-detail-screen",
        ];
        screens.forEach((id) => {
          const el = document.getElementById(id);
          if (el) {
            el.classList.add("hidden");
            el.classList.remove("lg:flex");
          }
        });
        const target = document.getElementById(screenId);
        if (target) {
          target.classList.remove("hidden");
          if (screenId === "quiz-screen") {
            target.classList.add("lg:flex");
          }
        }
        window.scrollTo(0, 0);
      };

      window.resetApp = () => {
        quizData = [];
        currentQuestionIndex = 0;
        userAnswers = [];
        selectedDifficulty = "";
        window.showScreen("start-screen");
      };

      window.setQuestionCount = (count) => {
        selectedQuestionCount = count;
        const buttons = document.querySelectorAll(".count-btn");
        buttons.forEach((btn) => {
          if (parseInt(btn.dataset.count) === count) {
            btn.classList.add("bg-blue-600", "text-white", "border-blue-600");
            btn.classList.remove("bg-white", "text-slate-600");
          } else {
            btn.classList.remove(
              "bg-blue-600",
              "text-white",
              "border-blue-600",
            );
            btn.classList.add("bg-white", "text-slate-600");
          }
        });
      };

      // Modal Controls
      window.showModal = (title, message, firstUnansweredIdx) => {
        document.getElementById("modal-title").innerText = title;
        document.getElementById("modal-message").innerText = message;
        const modal = document.getElementById("alert-modal");
        modal.classList.remove("hidden");
        modal.classList.add("flex");

        window.currentUnansweredIdx = firstUnansweredIdx;
      };

      window.closeModal = () => {
        const modal = document.getElementById("alert-modal");
        modal.classList.add("hidden");
        modal.classList.remove("flex");
      };

      window.goToUnanswered = () => {
        if (typeof window.currentUnansweredIdx === "number") {
          window.jumpToQuestion(window.currentUnansweredIdx);
        }
        window.closeModal();
      };

      async function fetchWithRetry(url, options, retries = 5, delay = 1000) {
        try {
          const response = await fetch(url, options);
          if (!response.ok) throw new Error("API request failed");
          return await response.json();
        } catch (error) {
          if (retries > 0) {
            await new Promise((res) => setTimeout(res, delay));
            return fetchWithRetry(url, options, retries - 1, delay * 2);
          }
          throw error;
        }
      }

      window.startDifficultySelection = () => {
        window.showScreen("difficulty-screen");
        window.setQuestionCount(5);
      };

      window.fetchQuizData = async (difficulty) => {
        selectedDifficulty = difficulty;
        window.showScreen("loading-screen");
        document.getElementById("loading-text").innerText =
          "AIê°€ ë‹¤ì–‘í•œ ìœ í˜•ì˜ ë¬¸ì œë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...";

        const systemPrompt = `You are a Spring Boot expert. Create exactly ${selectedQuestionCount} questions in Korean.
            Difficulty: ${difficulty}. 
            Include a mix of 'multiple_choice', 'short_answer' (ë‹¨ë‹µí˜•), and 'essay' (ì„œìˆ í˜•) questions.
            Return ONLY a valid JSON array of objects. Each object MUST have:
            - type: string ('multiple_choice' | 'short_answer' | 'essay')
            - question: string
            - options: array of 4 strings (only for multiple_choice, otherwise empty array)
            - answer: string or integer (for multiple_choice, index 0-3. for short_answer, the correct term. for essay, a model answer)
            - explanation: string (in Korean)`;

        const userQuery = `Generate ${selectedQuestionCount} mixed-type (MCQ, Short, Essay) Spring Boot quiz questions in Korean with ${difficulty} difficulty.`;

        try {
          const result = await fetchWithRetry(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                  responseMimeType: "application/json",
                  responseSchema: {
                    type: "ARRAY",
                    items: {
                      type: "OBJECT",
                      properties: {
                        type: { type: "STRING" },
                        question: { type: "STRING" },
                        options: { type: "ARRAY", items: { type: "STRING" } },
                        answer: { type: "STRING" },
                        explanation: { type: "STRING" },
                      },
                      required: [
                        "type",
                        "question",
                        "options",
                        "answer",
                        "explanation",
                      ],
                    },
                  },
                },
              }),
            },
          );

          const rawContent = result.candidates?.[0]?.content?.parts?.[0]?.text;
          quizData = JSON.parse(rawContent);
          currentQuestionIndex = 0;
          userAnswers = new Array(quizData.length).fill("");

          window.showScreen("quiz-screen");
          window.renderQuestion();
        } catch (error) {
          console.error(error);
          alert("ë¬¸ì œë¥¼ ìƒì„±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          window.showScreen("start-screen");
        }
      };

      window.jumpToQuestion = (index) => {
        currentQuestionIndex = index;
        window.renderQuestion();
      };

      window.renderQuestion = () => {
        if (!quizData[currentQuestionIndex]) return;
        const question = quizData[currentQuestionIndex];

        // Navigator Update
        const navContainer = document.getElementById("quiz-nav");
        navContainer.innerHTML = "";
        quizData.forEach((_, idx) => {
          const isCurrent = idx === currentQuestionIndex;
          const isAnswered =
            userAnswers[idx] !== "" && userAnswers[idx] !== null;
          const navItem = document.createElement("button");
          navItem.onclick = () => window.jumpToQuestion(idx);
          navItem.className = `w-10 h-10 rounded-lg font-bold flex items-center justify-center transition-all border-2 
                    ${isCurrent ? "border-blue-600 scale-110 shadow-md" : "border-transparent"} 
                    ${isAnswered ? "bg-blue-500 text-white" : "bg-slate-100 text-slate-400"}`;
          navItem.innerText = idx + 1;
          navContainer.appendChild(navItem);
        });

        // Header/Progress
        document.getElementById("progress-text").innerText =
          `ë¬¸ì œ ${currentQuestionIndex + 1} / ${quizData.length}`;
        document.getElementById("progress-bar").style.width =
          `${((currentQuestionIndex + 1) / quizData.length) * 100}%`;

        // Question Text with Numbering
        document.getElementById("question-text").innerHTML = `
                <span class="text-blue-600 mr-2">Q${currentQuestionIndex + 1}.</span> 
                ${question.question}
            `;

        const container = document.getElementById("options-container");
        container.innerHTML = "";

        // Render Content by Type
        if (question.type === "multiple_choice") {
          question.options.forEach((option, index) => {
            const btn = document.createElement("button");
            const isSelected =
              userAnswers[currentQuestionIndex] !== "" &&
              parseInt(userAnswers[currentQuestionIndex]) === index;
            btn.className = `w-full text-left p-4 rounded-xl border-2 transition-all font-medium text-slate-700 flex items-center ${isSelected ? "border-blue-500 bg-blue-50" : "border-slate-100 hover:border-blue-300 hover:bg-slate-50"}`;
            btn.innerHTML = `<span class="w-8 h-8 rounded-full ${isSelected ? "bg-blue-500 text-white" : "bg-slate-100"} flex items-center justify-center mr-3 text-sm font-bold">${index + 1}</span> ${option}`;
            btn.onclick = () => {
              userAnswers[currentQuestionIndex] = index.toString();
              window.renderQuestion();
            };
            container.appendChild(btn);
          });
        } else if (question.type === "short_answer") {
          const input = document.createElement("input");
          input.type = "text";
          input.placeholder = "ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”...";
          input.className =
            "w-full p-4 rounded-xl border-2 border-slate-100 focus:border-blue-500 outline-none transition-all";
          input.value = userAnswers[currentQuestionIndex] || "";
          input.oninput = (e) => {
            userAnswers[currentQuestionIndex] = e.target.value;
          };
          container.appendChild(input);
        } else {
          const textarea = document.createElement("textarea");
          textarea.placeholder = "ë‚´ìš©ì„ ì„œìˆ í•´ ì£¼ì„¸ìš”...";
          textarea.className =
            "w-full p-4 rounded-xl border-2 border-slate-100 focus:border-blue-500 outline-none transition-all h-32 resize-none";
          textarea.value = userAnswers[currentQuestionIndex] || "";
          textarea.oninput = (e) => {
            userAnswers[currentQuestionIndex] = e.target.value;
          };
          container.appendChild(textarea);
        }

        document.getElementById("prev-btn").disabled =
          currentQuestionIndex === 0;
        const isLast = currentQuestionIndex === quizData.length - 1;
        document.getElementById("next-btn").classList.toggle("hidden", isLast);
        document
          .getElementById("submit-btn")
          .classList.toggle("hidden", !isLast);
      };

      window.goToNextQuestion = () => {
        if (currentQuestionIndex < quizData.length - 1) {
          currentQuestionIndex++;
          window.renderQuestion();
        }
      };

      window.goToPrevQuestion = () => {
        if (currentQuestionIndex > 0) {
          currentQuestionIndex--;
          window.renderQuestion();
        }
      };

      window.showResults = async () => {
        const unansweredIdx = userAnswers.findIndex(
          (a) => a === "" || a === null || a.trim() === "",
        );
        const answeredCount = userAnswers.filter(
          (a) => a !== "" && a !== null && a.trim() !== "",
        ).length;

        if (answeredCount === 0) {
          window.showModal(
            "ì•Œë¦¼",
            "ë¬¸ì œë¥¼ í•˜ë‚˜ë„ í’€ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìµœì†Œ í•œ ë¬¸ì œ ì´ìƒ ë‹µë³€í•´ ì£¼ì„¸ìš”.",
            0,
          );
          return;
        }

        if (unansweredIdx !== -1) {
          window.showModal(
            "ì•Œë¦¼",
            `ì•„ì§ í’€ì§€ ì•Šì€ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. (ë¬¸ì œ ${unansweredIdx + 1}) ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`,
            unansweredIdx,
          );
          // "ê²°ê³¼ ë³´ê¸°" ë²„íŠ¼ì„ ëª¨ë‹¬ì— ì¶”ê°€í•˜ê¸° ìœ„í•´ ë¡œì§ì„ ë¶„ê¸°
          const modalAction = document.getElementById("modal-action-btn");
          modalAction.innerText = "ê²°ê³¼ ë³´ê¸°";
          modalAction.onclick = () => {
            window.closeModal();
            window.processResults();
          };
          return;
        }

        window.processResults();
      };

      window.processResults = async () => {
        window.showScreen("loading-screen");
        document.getElementById("loading-text").innerText =
          "í•™ìŠµ ê²°ê³¼ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...";

        let score = 0;
        quizData.forEach((q, i) => {
          const uAns = (userAnswers[i] || "").toString().trim().toLowerCase();
          const qAns = (q.answer || "").toString().trim().toLowerCase();

          if (q.type === "multiple_choice") {
            if (uAns === qAns) score++;
          } else if (q.type === "short_answer") {
            if (uAns === qAns) score++;
          } else {
            if (uAns.length > 10) score++;
          }
        });

        if (currentUser) {
          try {
            const historyRef = collection(
              db,
              "artifacts",
              appId,
              "users",
              currentUser.uid,
              "history",
            );
            await addDoc(historyRef, {
              difficulty: selectedDifficulty,
              score: score,
              total: quizData.length,
              quizData: quizData,
              userAnswers: userAnswers,
              timestamp: new Date().toISOString(),
            });
          } catch (e) {
            console.error(e);
          }
        }

        window.showScreen("result-screen");
        document.getElementById("score-badge").innerText =
          `${score} / ${quizData.length} ì `;
        const reviewContainer = document.getElementById("review-container");
        reviewContainer.innerHTML = "";

        quizData.forEach((q, i) => {
          let isCorrect = false;
          const uAns = (userAnswers[i] || "").trim();
          const qAns = (q.answer || "").toString().trim();

          if (q.type === "multiple_choice") isCorrect = uAns === qAns;
          else if (q.type === "short_answer")
            isCorrect = uAns.toLowerCase() === qAns.toLowerCase();
          else isCorrect = uAns.length > 20;

          const item = document.createElement("div");
          item.className = `p-6 rounded-2xl border-l-4 ${isCorrect ? "bg-green-50 border-green-500" : "bg-red-50 border-red-500"}`;

          let answerDisplay = "";
          if (q.type === "multiple_choice") {
            answerDisplay = `<p class="text-sm">ë‚´ ë‹µë³€: ${userAnswers[i] !== "" ? q.options[parseInt(userAnswers[i])] : "ë¯¸ì‘ë‹µ"}</p>
                                     <p class="text-sm font-bold text-green-700">ì •ë‹µ: ${q.options[parseInt(q.answer)]}</p>`;
          } else {
            answerDisplay = `<p class="text-sm">ë‚´ ë‹µë³€: ${uAns || "ë¯¸ì‘ë‹µ"}</p>
                                     <p class="text-sm font-bold text-green-700">ëª¨ë²” ë‹µì•ˆ: ${q.answer}</p>`;
          }

          item.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <p class="font-bold text-slate-800">Q${i + 1}. ${q.question}</p>
                    </div>
                    ${answerDisplay}
                    <div class="mt-3 pt-3 border-t border-slate-200 text-xs text-slate-500 italic">í•´ì„¤: ${q.explanation}</div>
                `;
          reviewContainer.appendChild(item);
        });
      };

      window.loadHistory = async () => {
        if (!currentUser) return;
        window.showScreen("loading-screen");
        try {
          const historyRef = collection(
            db,
            "artifacts",
            appId,
            "users",
            currentUser.uid,
            "history",
          );
          const querySnapshot = await getDocs(historyRef);
          const historyList = document.getElementById("history-list");
          historyList.innerHTML = "";

          const docs = [];
          querySnapshot.forEach((doc) =>
            docs.push({ id: doc.id, ...doc.data() }),
          );
          docs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

          if (docs.length === 0) {
            historyList.innerHTML =
              '<div class="text-center p-10 text-slate-400">ì•„ì§ í•™ìŠµ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
          } else {
            docs.forEach((data) => {
              const dateStr = new Date(data.timestamp).toLocaleString();
              const card = document.createElement("div");
              card.className =
                "glass p-5 rounded-2xl border border-white shadow-sm hover:shadow-md transition-all cursor-pointer flex justify-between items-center";
              card.onclick = () => window.showHistoryDetail(data);
              card.innerHTML = `
                            <div>
                                <span class="text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded bg-slate-100 text-slate-500 border border-slate-200">${data.difficulty}</span>
                                <h4 class="text-sm font-bold text-slate-800 mt-1">${dateStr}</h4>
                            </div>
                            <div class="text-right">
                                <span class="text-xl font-bold text-blue-600">${data.score}</span>
                                <span class="text-slate-400">/ ${data.total}</span>
                            </div>
                        `;
              historyList.appendChild(card);
            });
          }
          window.showScreen("history-screen");
        } catch (e) {
          console.error(e);
          window.showScreen("start-screen");
        }
      };

      window.showHistoryDetail = (data) => {
        window.showScreen("history-detail-screen");
        document.getElementById("detail-title").innerText =
          `${data.difficulty} ë³µìŠµ`;
        const container = document.getElementById("detail-content");
        container.innerHTML = "";

        data.quizData.forEach((q, i) => {
          const uAns = (data.userAnswers[i] || "").trim();
          const qAns = (q.answer || "").toString().trim();
          let isCorrect =
            q.type === "multiple_choice"
              ? uAns === qAns
              : uAns.toLowerCase() === qAns.toLowerCase();

          const item = document.createElement("div");
          item.className = `p-6 rounded-2xl border-l-4 ${isCorrect ? "bg-green-50 border-green-500" : "bg-red-50 border-red-500"} mb-4`;

          let answerDisplay = "";
          if (q.type === "multiple_choice") {
            answerDisplay = `<p class="text-sm">ë‚´ ë‹µë³€: ${uAns !== "" ? q.options[parseInt(uAns)] : "ë¯¸ì‘ë‹µ"}</p>
                                     <p class="text-sm text-green-700 font-semibold">ì •ë‹µ: ${q.options[parseInt(q.answer)]}</p>`;
          } else {
            answerDisplay = `<p class="text-sm">ë‚´ ë‹µë³€: ${uAns || "ë¯¸ì‘ë‹µ"}</p>
                                     <p class="text-sm text-green-700 font-semibold">ëª¨ë²” ë‹µì•ˆ: ${q.answer}</p>`;
          }

          item.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <p class="font-bold text-slate-800">Q${i + 1}. ${q.question}</p>
                    </div>
                    ${answerDisplay}
                    <div class="mt-3 pt-3 border-t border-slate-200 text-sm text-slate-600"><strong>í•´ì„¤:</strong> ${q.explanation}</div>
                `;
          container.appendChild(item);
        });
      };
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
        background-color: #f8fafc;
      }
      .glass {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
      }
      .loader {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3b82f6;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      #quiz-nav button {
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Modal Overlay */
      #alert-modal {
        background: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(4px);
      }
    </style>
  </head>
  <body class="min-h-screen p-4 md:p-8">
    <div id="app" class="max-w-5xl mx-auto">
      <!-- Header -->
      <header class="text-center mb-10">
        <h1 class="text-4xl font-bold text-slate-800 mb-2">ğŸƒ [ìŠ¤ë¶€í€´]</h1>
        <p class="text-slate-600 italic">Spring Boot AI Quiz Master</p>
      </header>

      <!-- Start Screen -->
      <div
        id="start-screen"
        class="max-w-3xl mx-auto glass rounded-3xl p-8 shadow-xl text-center border border-white"
      >
        <div class="mb-8">
          <div
            class="w-20 h-20 bg-green-100 rounded-2xl flex items-center justify-center mx-auto mb-4"
          >
            <svg
              class="w-12 h-12 text-green-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
              ></path>
            </svg>
          </div>
          <h2 class="text-2xl font-semibold mb-2 text-slate-800">
            í™˜ì˜í•©ë‹ˆë‹¤!
          </h2>
          <p class="text-slate-500">
            ë‹¤ì–‘í•œ ìœ í˜•ì˜ Spring Boot í€´ì¦ˆë¡œ ì‹¤ë ¥ì„ í™•ì¸í•˜ì„¸ìš”.
          </p>
        </div>
        <div class="space-y-4">
          <button
            onclick="startDifficultySelection()"
            class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-5 px-8 rounded-2xl transition-all shadow-lg text-xl"
          >
            ìƒˆ í€´ì¦ˆ ì‹œì‘í•˜ê¸°
          </button>
          <button
            onclick="loadHistory()"
            class="w-full bg-white border border-slate-200 text-slate-700 font-bold py-4 px-8 rounded-2xl hover:bg-slate-50 transition-all flex items-center justify-center"
          >
            í•™ìŠµ ë‚´ì—­ ë³´ê¸°
          </button>
        </div>
      </div>

      <!-- Difficulty Selection Screen -->
      <div
        id="difficulty-screen"
        class="hidden max-w-3xl mx-auto glass rounded-3xl p-8 shadow-xl text-center border border-white"
      >
        <h2 class="text-2xl font-bold text-slate-800 mb-6">
          ì„¤ì •ì„ ì™„ë£Œí•´ ì£¼ì„¸ìš”
        </h2>
        <div class="mb-8">
          <p
            class="text-sm font-bold text-slate-500 mb-4 text-left uppercase tracking-wider px-2"
          >
            ë¬¸ì œ ê°œìˆ˜ ì„ íƒ
          </p>
          <div class="flex gap-4 justify-center">
            <button
              data-count="3"
              onclick="setQuestionCount(3)"
              class="count-btn flex-1 py-3 rounded-xl border-2 font-bold transition-all bg-white text-slate-600 border-slate-100 hover:border-blue-200"
            >
              3ë¬¸ì œ
            </button>
            <button
              data-count="5"
              onclick="setQuestionCount(5)"
              class="count-btn flex-1 py-3 rounded-xl border-2 font-bold transition-all bg-blue-600 text-white border-blue-600"
            >
              5ë¬¸ì œ
            </button>
            <button
              data-count="10"
              onclick="setQuestionCount(10)"
              class="count-btn flex-1 py-3 rounded-xl border-2 font-bold transition-all bg-white text-slate-600 border-slate-100 hover:border-blue-200"
            >
              10ë¬¸ì œ
            </button>
          </div>
        </div>
        <p
          class="text-sm font-bold text-slate-500 mb-4 text-left uppercase tracking-wider px-2"
        >
          ë‚œì´ë„ ì„ íƒ
        </p>
        <div class="grid grid-cols-1 gap-4">
          <button
            onclick="fetchQuizData('ì‰¬ì›€')"
            class="p-6 rounded-2xl bg-blue-50 border-2 border-blue-100 hover:border-blue-400 transition-all text-left group"
          >
            <span class="block text-xl font-bold text-blue-700">ì‰¬ì›€</span>
            <span class="text-sm text-blue-600">ê¸°ì´ˆ ê°œë… ìœ„ì£¼ì˜ ë¬¸ì œ</span>
          </button>
          <button
            onclick="fetchQuizData('ì¤‘ê°„')"
            class="p-6 rounded-2xl bg-yellow-50 border-2 border-yellow-100 hover:border-yellow-400 transition-all text-left group"
          >
            <span class="block text-xl font-bold text-yellow-700">ì¤‘ê°„</span>
            <span class="text-sm text-yellow-600">ì‹¤ë¬´ ì‘ìš©ë ¥ í…ŒìŠ¤íŠ¸</span>
          </button>
          <button
            onclick="fetchQuizData('ì–´ë ¤ì›€')"
            class="p-6 rounded-2xl bg-red-50 border-2 border-red-100 hover:border-red-400 transition-all text-left group"
          >
            <span class="block text-xl font-bold text-red-700">ì–´ë ¤ì›€</span>
            <span class="text-sm text-red-600"
              >ì‹¬í™” êµ¬ì¡° ë¶„ì„ ë° ì„œìˆ í˜• ìœ„ì£¼</span
            >
          </button>
        </div>
        <button
          onclick="resetApp()"
          class="mt-8 text-slate-400 hover:text-slate-600 font-medium flex items-center justify-center mx-auto"
        >
          ë’¤ë¡œ ê°€ê¸°
        </button>
      </div>

      <!-- Loading Screen -->
      <div
        id="loading-screen"
        class="hidden max-w-3xl mx-auto glass rounded-3xl p-12 shadow-xl text-center border border-white"
      >
        <div class="flex flex-col items-center">
          <div class="loader mb-4"></div>
          <p id="loading-text" class="text-slate-700 font-medium italic">
            AIê°€ ë¬¸ì œë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...
          </p>
        </div>
      </div>

      <!-- Quiz Screen -->
      <div
        id="quiz-screen"
        class="hidden flex-col lg:flex-row gap-8 items-start"
      >
        <aside class="lg:w-64 flex-shrink-0 w-full">
          <div class="glass rounded-3xl p-6 shadow-lg border border-white">
            <h4
              class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4"
            >
              ë¬¸ì œ ëª©ë¡
            </h4>
            <div
              id="quiz-nav"
              class="grid grid-cols-5 lg:grid-cols-4 gap-3"
            ></div>
          </div>
        </aside>
        <main class="flex-grow w-full">
          <div class="mb-4 flex justify-between items-center px-2">
            <span
              id="progress-text"
              class="text-sm font-semibold text-slate-500"
              >ë¬¸ì œ 1 / 10</span
            >
            <div class="h-2 w-32 bg-slate-200 rounded-full overflow-hidden">
              <div
                id="progress-bar"
                class="h-full bg-green-500 transition-all"
                style="width: 10%"
              ></div>
            </div>
          </div>
          <div
            id="question-card"
            class="glass rounded-3xl p-8 shadow-xl border border-white mb-6"
          >
            <h3
              id="question-text"
              class="text-xl font-bold text-slate-800 mb-6 leading-relaxed flex items-start"
            ></h3>
            <div id="options-container" class="space-y-3"></div>
          </div>
          <div class="flex justify-between items-center gap-4">
            <button
              id="prev-btn"
              onclick="goToPrevQuestion()"
              class="flex-1 bg-white border border-slate-200 text-slate-600 font-bold py-4 rounded-2xl hover:bg-slate-50 disabled:opacity-30"
            >
              ì´ì „
            </button>
            <button
              id="next-btn"
              onclick="goToNextQuestion()"
              class="flex-1 bg-slate-800 text-white font-bold py-4 rounded-2xl hover:bg-slate-900"
            >
              ë‹¤ìŒ
            </button>
            <button
              id="submit-btn"
              onclick="showResults()"
              class="hidden flex-1 bg-green-600 text-white font-bold py-4 rounded-2xl hover:bg-green-700 transition-all"
            >
              ê²°ê³¼ í™•ì¸
            </button>
          </div>
        </main>
      </div>

      <!-- Result Screen -->
      <div
        id="result-screen"
        class="hidden max-w-3xl mx-auto glass rounded-3xl p-8 shadow-xl border border-white"
      >
        <div class="text-center mb-8">
          <h2 class="text-3xl font-bold text-slate-800 mb-2">í•™ìŠµ ë¶„ì„ ê²°ê³¼</h2>
          <div
            id="score-badge"
            class="inline-block px-8 py-3 bg-blue-600 text-white rounded-full font-bold text-2xl shadow-md"
          >
            0 / 10
          </div>
        </div>
        <div id="review-container" class="space-y-4 mb-8"></div>
        <button
          onclick="resetApp()"
          class="w-full bg-slate-800 text-white font-bold py-5 rounded-2xl hover:bg-slate-900 transition-all shadow-lg"
        >
          í™ˆìœ¼ë¡œ ì´ë™
        </button>
      </div>

      <!-- History Screen -->
      <div id="history-screen" class="hidden max-w-3xl mx-auto">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold text-slate-800">ë‚˜ì˜ í•™ìŠµ ë‚´ì—­</h2>
          <button
            onclick="resetApp()"
            class="text-slate-500 hover:text-slate-800 font-bold"
          >
            ë‹«ê¸°
          </button>
        </div>
        <div id="history-list" class="space-y-4"></div>
      </div>

      <!-- History Detail Screen -->
      <div id="history-detail-screen" class="hidden max-w-3xl mx-auto">
        <div class="flex items-center justify-between mb-6">
          <h2
            id="detail-title"
            class="text-xl font-bold text-slate-800 leading-tight"
          >
            ë³µìŠµí•˜ê¸°
          </h2>
          <button
            onclick="loadHistory()"
            class="text-slate-500 hover:text-slate-800 font-bold"
          >
            ëª©ë¡ìœ¼ë¡œ
          </button>
        </div>
        <div id="detail-content" class="space-y-4"></div>
      </div>
    </div>

    <!-- Alert Modal -->
    <div
      id="alert-modal"
      class="fixed inset-0 z-50 hidden items-center justify-center p-4"
    >
      <div
        class="bg-white rounded-3xl shadow-2xl max-w-sm w-full p-8 text-center animate-in fade-in zoom-in duration-200"
      >
        <div
          class="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4"
        >
          <svg
            class="w-8 h-8 text-amber-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
            ></path>
          </svg>
        </div>
        <h3 id="modal-title" class="text-xl font-bold text-slate-800 mb-2">
          ì•Œë¦¼
        </h3>
        <p id="modal-message" class="text-slate-500 mb-8 leading-relaxed">
          ì•„ì§ í’€ì§€ ì•Šì€ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.
        </p>
        <div class="flex flex-col gap-3">
          <button
            onclick="goToUnanswered()"
            class="w-full bg-slate-800 text-white font-bold py-4 rounded-2xl hover:bg-slate-900 transition-all"
          >
            ë¬¸ì œë¡œ ëŒì•„ê°€ê¸°
          </button>
          <button
            id="modal-action-btn"
            onclick="closeModal()"
            class="w-full bg-slate-100 text-slate-600 font-bold py-4 rounded-2xl hover:bg-slate-200 transition-all"
          >
            ë‹«ê¸°
          </button>
        </div>
      </div>
    </div>
  </body>
</html>
